import matplotlib.pyplot as plt
import numpy as np

# Clean function: convert "nan" → np.nan, everything else → float
def clean_list(L):
    return [np.nan if str(v).lower() == "nan" else float(v) for v in L]

x = ['FindΙMB', 'De', 'Do', 'De + Do']

list1 = [0.698989898989899, 0.6788277511961722, 0.6501068376068376, 0.6491769547325104, 0.780232558139535, 0.5620842572062084, 0.5597713097713097, 0.5545267489711935, 0.7242424242424242, 0.7173684210526317, 0.6893939393939394, 0.7168478260869565, 0.6622448979591837, 0.6152173913043478, 0.6591836734693878, 0.6688640973630832, 0.7216024340770791, 0.7209876543209877, 0.6890120967741935, 0.6389189189189189]
list2 = [0.7121212121212122, 0.69377990430622, 0.7558760683760685, 0.7294238683127573, 0.6703488372093023, 0.664079822616408, 0.6008316008316009, 0.6651234567901234, 0.709090909090909, 0.7147368421052631, 0.7328282828282828, 0.7836956521739131, 0.6285714285714286, 0.6407608695652174, 0.6469387755102041, 0.6054766734279918, 0.7033468559837728, 0.7148148148148148, 0.7076612903225807, 0.6102702702702704]
list3 = [0.6530303030303031, 0.69377990430622, 0.7152777777777778, 0.6862139917695472, 0.7633720930232558, 0.6646341463414633, 0.5462577962577962, 0.6692386831275721, 0.6207070707070707, 0.6836842105263158, 0.6212121212121211, 0.7380434782608696, 0.6301020408163265, 0.7027173913043478, 0.6316326530612245, 0.6835699797160243, 0.6962474645030426, 0.7524691358024691, 0.6965725806451613, 0.7021621621621622]
list4 = [0.7171717171717171, 0.6764354066985646, 0.701388888888889, 0.7222222222222223, 0.7767441860465116, 0.6457871396895788, 0.5816008316008316, 0.6008230452674898, 0.6878787878787878, 0.7315789473684211, 0.7308080808080808, 0.7304347826086957, 0.6010204081632653, 0.6271739130434782, 0.6403061224489797, 0.6333671399594321, 0.7302231237322514, 0.7382716049382717, 0.6607862903225807, 0.6324324324324325]



# Convert everything to float (handles "nan", nan, np.nan)
list1 = np.array(list1, dtype=float)
list2 = np.array(list2, dtype=float)
list3 = np.array(list3, dtype=float)
list4 = np.array(list4, dtype=float)

# Remove NaNs from each list
list1_clean = list1[~np.isnan(list1)]
list2_clean = list2[~np.isnan(list2)]
list3_clean = list3[~np.isnan(list3)]
list4_clean = list4[~np.isnan(list4)]

# Put into a list of arrays for boxplot
y_clean = [list1_clean, list2_clean, list3_clean, list4_clean]

# Plot
plt.boxplot(y_clean)

# Compute medians
medians = [np.median(a) for a in y_clean]

colors = ['red', 'blue', 'green', 'purple']
for i, (median, color) in enumerate(zip(medians, colors), start=1):
    plt.plot([0, i], [median, median], linestyle="--",
             color=color, linewidth=2, label=x[i-1])

plt.xticks([1, 2, 3, 4], x)
plt.ylabel("AUC")
plt.title("Experiment 2, Binary and Categorical Covariates")
plt.legend()
plt.show()

import numpy as np
import matplotlib.pyplot as plt


# Clean function: convert "nan" → np.nan, everything else → float
def clean_list(L):
    return [np.nan if str(v).lower() == "nan" else float(v) for v in L]


x = ['FindΙMB', 'De', 'Do', 'De + Do', 'ATE_A2', 'ATE_A1']

list1 = [0.6961484661503987, 0.6937288851351351, 0.646574207386587, 0.5359840751327072, 0.7065138423512866, 0.6517752940120298, 0.49826602683429755, 0.5111293198714084, 0.6036314074445419, 0.6561059331422567, 0.5531631929288521, 0.6203719082919551, 0.6001046345447121, 0.5710102408579465, 0.5821091068501886, 0.5320683157793024, 0.5807270625729419, 0.723674334631613, 0.43143459915611815, 0.670798326591294]
list2 = [0.6171753376601068, 0.6812080266624664, 0.6737113237448554, 0.5841374478184757, 0.7672172128778684, 0.7164665961446368, 0.5813609203124888, 0.5997184942300849, 0.5168743214746523, 0.6594654489599525, 0.518545042773682, 0.6891156707216833, 0.6171304466893865, 0.5762983134018695, 0.5154705652852436, 0.6031270285621552, 0.5916879147815943, 0.6868559315157416, 0.4651562079181255, 0.6353542458345512]
list3 = [0.6647882202977391, 0.6100193874815164, 0.6882131573121892, 0.633379710461225, 0.6713616717087281, 0.7024541875502246, 0.5143049013835739, 0.5151764039238029, 0.5328210831144018, 0.7169009711444889, 0.5125329063252533, 0.6845602543438949, 0.5692246835443038, 0.5305791298322685, 0.5444006110540921, 0.6274183345009179, 0.5364209145854715, 0.7412251080580425, 0.46081198473231233, 0.6018049028499189]
list4 = [0.684973434218256, 0.6427674171417528, 0.6353277032179351, 0.5787335686465435, 0.7082288925095042, 0.6805083274366432, 0.5464794303797468, 0.5548979633235962, 0.5859856783511848, 0.681445087744534, 0.5475798904188712, 0.6419551262823205, 0.5539770176856091, 0.5068389633824131, 0.5610307414104883, 0.5726409666283084, 0.6017099476850267, 0.7412251080580425, 0.40018308356370336, 0.6216212653400311]


list5 = [0.6896551724137931, 0.7, 0.6363636363636364, 0.5625, 0.78125, 0.7027027027027027, 0.5757575757575758, 0.6666666666666666, 0.5806451612903226, 0.6666666666666666, 0.5666666666666667, 0.6428571428571429, 0.6285714285714286, 0.5897435897435898, 0.5757575757575758, 0.5833333333333334, 0.6333333333333333, 0.7631578947368421, 0.4827586206896552, 0.6923076923076923]
list6 = [0.38235294117647056, 0.696969696969697, 0.6, 0.5806451612903226, 0.5806451612903226, 0.5769230769230769, 0.6, 0.4444444444444444, 0.375, 0.5185185185185185, 0.48484848484848486, 0.6190476190476191, 0.4642857142857143, 0.7083333333333334, 0.5333333333333333, 0.48148148148148145, 0.45454545454545453, 0.64, 0.5294117647058824, 0.43478260869565216]

# Convert everything to float
list1 = np.array(clean_list(list1), dtype=float)
list2 = np.array(clean_list(list2), dtype=float)
list3 = np.array(clean_list(list3), dtype=float)
list4 = np.array(clean_list(list4), dtype=float)
list5 = np.array(clean_list(list5), dtype=float)
list6 = np.array(clean_list(list6), dtype=float)

# Remove NaNs for boxplot
y_clean = [l[~np.isnan(l)] for l in [list1, list2, list3, list4, list5, list6]]

# Boxplot
plt.boxplot(y_clean)

# Compute medians
medians = [np.median(a) for a in y_clean]
colors = ['red', 'blue', 'green', 'purple', 'yellow', 'magenta']

# Median lines and missingness annotation below the line
for i, (median, color, col) in enumerate(zip(medians, colors, [list1, list2, list3, list4, list5, list6]), start=1):
    plt.plot([0, i], [median, median], linestyle="--", color=color, linewidth=2, label=x[i - 1])


    # Missing values
    n_total = len(col)
    n_missing = np.isnan(col).sum()
    if n_missing > 0:
        pct_missing = n_missing / n_total * 100
        plt.text(i, median - 0.15, f'{pct_missing:.0f}% NaN',
                 ha='center', color='red', fontsize=9)


# Labels
plt.xticks([1, 2, 3, 4, 5, 6], x)
plt.ylabel("Direct Expected Utility\n(DEU)")
plt.title("Experiment 2, Binary and Categorical Covariates")
plt.legend()
plt.show()
